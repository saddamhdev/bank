Load balancing **‡¶ï‡ßã‡¶•‡¶æ‡ßü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá**‚Äîmicroservices banking setup-‡¶è ‡¶è‡¶ü‡¶æ ‡ß©‡¶ü‡¶æ ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡ßü ‡¶π‡ßü‡•§ ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶è‡¶ñ‡¶® (local ports ‡¶¶‡¶ø‡ßü‡ßá) single instance ‡¶ö‡¶æ‡¶≤‡¶æ‡¶ö‡ßç‡¶õ, ‡¶§‡¶æ‡¶á **Step-2 ‡¶è load balancing ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá ‡¶®‡¶æ**‡•§ ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ enterprise ‡¶ï‡¶∞‡¶§‡ßá ‡¶ó‡ßá‡¶≤‡ßá ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶ú‡¶æ‡ßü‡¶ó‡¶æ‡¶ó‡ßÅ‡¶≤‡ßã‡¶§‡ßá **must**‡•§

---

## 1) Client ‚Üí API Gateway (Edge Load Balancer)

**‡¶ï‡ßã‡¶•‡¶æ‡ßü?** Internet/WAF-‡¶è‡¶∞ ‡¶™‡¶∞‡ßá, Gateway-‡¶è‡¶∞ ‡¶∏‡¶æ‡¶Æ‡¶®‡ßá
**‡¶ï‡ßá‡¶®?** ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞ ‡¶π‡¶æ‡¶ú‡¶æ‡¶∞ client request ‡¶ï‡ßá multiple gateway instance ‡¶è ‡¶≠‡¶æ‡¶ó ‡¶ï‡¶∞‡¶æ

**Tools (real world):**

* Cloudflare / AWS ALB / Nginx / HAProxy / F5

**Flow:**

```
Clients ‚Üí (LB) ‚Üí gateway-1 / gateway-2 / gateway-3 ‚Üí services
```

‚úÖ Banking-‡¶è ‡¶è‡¶ü‡¶æ common ‡¶ï‡¶æ‡¶∞‡¶£ gateway down ‡¶π‡¶≤‡ßá ‡¶™‡ßÅ‡¶∞‡ßã ‡¶¨‡ßç‡¶Ø‡¶æ‡¶Ç‡¶ï down.

---

## 2) API Gateway ‚Üí Microservice instances (Service-to-Service Load Balancing)

**‡¶ï‡ßã‡¶•‡¶æ‡ßü?** Gateway ‡¶Ø‡¶ñ‡¶® `/accounts/**` ‡¶ï‡ßá `account-service` ‡¶è ‡¶™‡¶æ‡¶†‡¶æ‡ßü‚Äî‡¶ì‡¶ñ‡¶æ‡¶®‡ßá
**‡¶ï‡ßá‡¶®?** `account-service` ‡¶è‡¶∞ 3‚Äì10‡¶ü‡¶æ instance ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá

**Local ‡¶è ‡¶ï‡ßá‡¶® ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ?** ‡¶§‡ßÅ‡¶Æ‡¶ø `uri: http://localhost:8083` fixed ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‚Äî‡¶Æ‡¶æ‡¶®‡ßá 1‡¶ü‡¶æ instance.

### Enterprise way (Kubernetes)

Gateway uri ‡¶π‡¶¨‡ßá service name:

```yaml
uri: lb://ACCOUNT-SERVICE
```

K8s Service ‡¶®‡¶ø‡¶ú‡ßá‡¶á load balance ‡¶ï‡¶∞‡ßá:

```
gateway ‚Üí account-service (ClusterIP) ‚Üí pods (round robin)
```

### Spring Cloud LoadBalancer (service discovery ‡¶•‡¶æ‡¶ï‡¶≤‡ßá)

Eureka/Consul ‡¶•‡¶æ‡¶ï‡¶≤‡ßá:

* Gateway `lb://` use ‡¶ï‡¶∞‡ßá
* Spring Cloud LoadBalancer instance pick ‡¶ï‡¶∞‡ßá

---

## 3) Internal load balancing (DB / Cache / MQ layer)

‡¶è‡¶ü‡¶æ app routing ‡¶®‡¶æ‚Äîinfra balancing:

* **PostgreSQL**: primary/replica + pgpool/HAProxy
* **Redis**: cluster/sentinel
* **RabbitMQ**: cluster + queue policies

Banking-‡¶è high availability ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ü‡¶æ ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£‡•§

---

# ‚úÖ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ current setup-‡¶è ‚Äú‡¶ï‡ßã‡¶•‡¶æ‡ßü‚Äù ‡¶≤‡¶æ‡¶ó‡¶¨‡ßá?

### ‡¶è‡¶ñ‡¶® (local dev):

* Load balancing **skip** ‡¶ï‡¶∞‡ßã
* ‡¶∂‡ßÅ‡¶ß‡ßÅ gateway routing + filters ‡¶†‡¶ø‡¶ï ‡¶ï‡¶∞‡ßã

### ‡¶Ø‡¶ñ‡¶® ‡ßß‡¶ü‡¶æ service multiple instance ‡¶ö‡¶æ‡¶≤‡¶æ‡¶¨‡ßá:

‡¶§‡¶ñ‡¶® LB ‡¶¶‡¶∞‡¶ï‡¶æ‡¶∞ ‡¶π‡¶¨‡ßá **Gateway ‚Üí service** ‡¶è

---

# üî• Local ‡¶è Load Balancing practice (simple demo)

‡¶ß‡¶∞‡ßã `account-service` 2 instance ‡¶ö‡¶æ‡¶≤‡¶æ‡¶¨‡ßá:

* account-1 ‚Üí 8083
* account-2 ‚Üí 8085

‡¶§‡¶æ‡¶∞‡¶™‡¶∞ Gateway route ‡¶è ‚Äúmultiple targets‚Äù ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶≤‡ßá ‡¶∏‡¶æ‡¶ß‡¶æ‡¶∞‡¶£‡¶§:

* Nginx/HAProxy ‡¶∏‡¶æ‡¶Æ‡¶®‡ßá ‡¶¨‡¶∏‡¶æ‡¶ì **‡¶¨‡¶æ**
* Service discovery + `lb://` setup ‡¶ï‡¶∞‡ßã

(‡¶∂‡ßá‡¶ñ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø easiest: **Nginx** ‡¶∏‡¶æ‡¶Æ‡¶®‡ßá)

---

## üß† Banking interview line

> ‚ÄúLoad balancing is used at the edge (clients to gateway) and internally (gateway to service instances), typically via ALB/Nginx and Kubernetes Services or Spring Cloud LoadBalancer with service discovery.‚Äù

---

‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ï‡ßã‡¶®‡¶ü‡¶æ ‡¶ö‡¶æ‡¶á‡¶õ?
1Ô∏è‚É£ **Local Nginx ‡¶¶‡¶ø‡ßü‡ßá account-service 2 instance LB** (‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶∏‡¶π‡¶ú)
2Ô∏è‚É£ **Kubernetes Service ‡¶¶‡¶ø‡ßü‡ßá LB** (enterprise standard)
3Ô∏è‚É£ **Eureka + lb:// route** (Spring-native)
