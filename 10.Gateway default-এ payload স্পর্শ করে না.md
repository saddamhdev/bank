ржЦрзБржм ржнрж╛рж▓рзЛ ржкрзНрж░рж╢рзНржи ЁЯСН
ржПржЯрж╛ржЗ ржмрзБржЭрж▓рзЗ **Gateway ржПржХржжржо clear рж╣рзЯрзЗ ржпрж╛ржмрзЗ**ред

рждрзБржорж┐ ржЬрж╛ржирждрзЗ ржЪрж╛ржУтАФ

> **Request-ржП ржпржжрж┐ payload (body + path + headers) ржкрж╛ржарж╛ржирзЛ рж╣рзЯ,
> рждрж╛рж╣рж▓рзЗ рж╕рзЗржЯрж╛ Spring Cloud Gateway ржжрж┐рзЯрзЗ ржХрзАржнрж╛ржмрзЗ ржпрж╛рзЯ?
> Gateway ржХрж┐ payload ржирж╖рзНржЯ ржХрж░рзЗ? change ржХрж░рзЗ?**

ржЪрж▓рзЛ ржПржХржжржо **simple тЖТ deep** ржнрж╛ржмрзЗ ржмрзБржЭрж┐ред

---

# ЁЯза Short answer (ржЖржЧрзЗ)

ЁЯСЙ **Gateway default-ржП payload рж╕рзНржкрж░рзНрж╢ ржХрж░рзЗ ржирж╛**
ЁЯСЙ **Body, path, headers ъ╖╕ыМАыбЬ forward рж╣рзЯ**
ЁЯСЙ **ржпржжрж┐ рждрзБржорж┐ filter ржжрж┐рзЯрзЗ ржмржжрж▓рж╛ржУ, рждржмрзЗржЗ change рж╣рзЯ**

---

# ЁЯзй Normal flow (рж╕ржмржЪрзЗрзЯрзЗ common case)

### Client request

```http
POST /txns/transfer
Content-Type: application/json

{
  "fromAccount": "A123",
  "toAccount": "B456",
  "amount": 5000
}
```

---

### Gateway ржХрзА ржХрж░рзЗ?

1я╕ПтГг Route match ржХрж░рзЗ (`/txns/**`)
2я╕ПтГг Filters ржЪрж╛рж▓рж╛рзЯ (JWT, rate limit, device detect)
3я╕ПтГг **Payload touch ржирж╛ ржХрж░рзЗ** forward ржХрж░рзЗ

---

### Downstream service ржкрж╛рзЯ (exact same)

```http
POST /transfer
Content-Type: application/json
X-Device-Type: MOBILE
X-Trace-Id: abc123

{
  "fromAccount": "A123",
  "toAccount": "B456",
  "amount": 5000
}
```

ЁЯСЙ **Body unchanged**
ЁЯСЙ рж╢рзБржзрзБ **extra headers ржпрзЛржЧ рж╣рзЯрзЗржЫрзЗ**

---

# ЁЯза Rule ржоржирзЗ рж░рж╛ржЦрзЛ

```
Gateway = Proxy
Proxy тЙа Parser
```

Gateway default-ржП **proxy** рж╣рж┐рж╕рзЗржмрзЗ ржХрж╛ржЬ ржХрж░рзЗред

---

# 1я╕ПтГг Payload ржХрзЛржерж╛рзЯ ржерж╛ржХрзЗ technically?

Spring Cloud Gateway uses **Reactive Netty**.

```
Request =
  Path
  + Headers
  + Body (Flux<DataBuffer>)
```

Gateway:

* Body stream ржзрж░рзЗ рж░рж╛ржЦрзЗ
* Consume ржХрж░рзЗ ржирж╛
* Forward ржХрж░рзЗ

---

# 2я╕ПтГг Gateway payload ржХржмрзЗ modify ржХрж░рзЗ?

тЭМ Default-ржП ржирж╛
тЬЕ Only when **YOU ask it to**

---

## ЁЯФ╣ Example: Header modify (safe)

```yaml
filters:
  - AddRequestHeader=X-Channel, WEB
```

тЬФ Body untouched

---

## ЁЯФ╣ Example: Path modify

```yaml
filters:
  - StripPrefix=1
```

Only path changes:

```
/txns/transfer тЖТ /transfer
```

тЬФ Body untouched

---

# 3я╕ПтГг Payload modify ржХрж░рж╛ ржпрж╛рзЯ? (Yes, but dangerous)

тЪая╕П **Banking systems generally avoid this**

Example (advanced):

```yaml
filters:
  - name: ModifyRequestBody
    args:
      rewriteFunction: "#{@myRewriteFn}"
```

ЁЯСЙ ржПржЦрж╛ржирзЗ body read + rewrite рж╣рзЯ
ЁЯСЙ Performance + security risk

ЁЯПж Banks rule:

> тЭМ Gateway-ржП business payload modify ржХрж░рж╛ ржпрж╛ржмрзЗ ржирж╛

---

# 4я╕ПтГг JWT / Rate limit / Device detect payload touch ржХрж░рзЗ?

тЭМ ржирж╛

| Check            | Payload change?   |
| ---------------- | ----------------- |
| JWT validation   | тЭМ                 |
| Rate limiting    | тЭМ                 |
| Device detection | тЭМ                 |
| Add header       | тЭМ                 |
| Block request    | тЭМ (request stops) |

---

# 5я╕ПтГг Payload large рж╣рж▓рзЗ ржХрзА рж╣рзЯ?

Gateway:

* Stream ржХрж░рзЗ
* Memory-рждрзЗ full load ржХрж░рзЗ ржирж╛
* Back-pressure handle ржХрж░рзЗ

ЁЯСЙ рждрж╛ржЗ file upload / big JSON ржарж┐ржХржнрж╛ржмрзЗ ржпрж╛рзЯ

---

# 6я╕ПтГг Debug ржХрж░рзЗ ржХрж┐ржнрж╛ржмрзЗ ржжрзЗржЦржмрзЗ payload intact ржЖржЫрзЗ?

### Step 1: Gateway-ржП log

```java
log.info("Incoming path: {}", exchange.getRequest().getURI());
```

### Step 2: Service-ржП log

```java
log.info("Received payload: {}", body);
```

ЁЯСЙ Same body ржжрзЗржЦржмрзЗ

---

# ЁЯПж Real banking example

### Transfer request

* Mobile app тЖТ Gateway
* Gateway:

  * JWT check
  * Device detect
  * Trace ID add
* Txn service:

  * ACID transaction
  * Ledger insert

ЁЯСЙ Gateway **ржЯрж╛ржХрж╛ ржЫрзЛржБрзЯ ржирж╛**, рж╢рзБржзрзБ **ржжрж░ржЬрж╛ ржкрж╛рж╣рж╛рж░рж╛ ржжрзЗрзЯ**

---

# ЁЯза One-line golden rule

> **Spring Cloud Gateway forwards request body, headers, and path as-is unless explicitly modified by filters.**

---

## ЁЯФЬ Next (рждрзБржорж┐ ржЪрж╛ржЗрж▓рзЗ)

1я╕ПтГг ModifyRequestBody ржХржЦржи/ржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ рж╣рзЯ
2я╕ПтГг Streaming vs blocking request difference
3я╕ПтГг Large payload security in banks
4я╕ПтГг Gateway vs BFF payload handling
5я╕ПтГг Common gateway payload mistakes

ЁЯСЙ ржирж╛ржорзНржмрж╛рж░ ржмрж▓рзЛ ЁЯСН
