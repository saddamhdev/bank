‡¶≠‡¶æ‡¶≤‡ßã ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡•§ **correlationId ‡¶è‡¶ï‡¶á ‡¶•‡¶æ‡¶ï‡¶¨‡ßá** ‡¶¨‡¶≤‡ßá *‡¶∏‡¶¨ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá‡¶∞ ‡¶≤‡¶ó ‡¶Æ‡¶ø‡¶ï‡ßç‡¶∏* ‡¶≤‡¶æ‡¶ó‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‚Äî‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ ‡¶¨‡¶æ‡¶∏‡ßç‡¶§‡¶¨‡ßá ‡¶¨‡ßÅ‡¶ù‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá ‡ß©‡¶ü‡¶æ ‡¶ú‡¶ø‡¶®‡¶ø‡¶∏ ‡¶¶‡¶ø‡ßü‡ßá:

## 1) `service` ‡¶´‡¶ø‡¶≤‡ßç‡¶° (‡¶∏‡¶¨‡¶ö‡ßá‡ßü‡ßá ‡¶∏‡¶π‡¶ú)

‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶Ø‡ßá‡¶≠‡¶æ‡¶¨‡ßá JSON ‡¶≤‡¶ó ‡¶ï‡¶∞‡¶õ, ‡¶∏‡ßá‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶õ‡ßá:

* `"service":"gateway-service"`
* `"service":"user-service"`
* `"service":"account-service"` ‚Ä¶

**‡¶Ø‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá error ‡¶π‡ßü‡ßá‡¶õ‡ßá, ‡¶∏‡ßá‡¶á ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá‡¶∞ service ‡¶®‡¶æ‡¶Æ‡ßá‡¶∞ ‡¶≤‡¶ó ‡¶≤‡¶æ‡¶á‡¶®‡ßá ERROR ‡¶•‡¶æ‡¶ï‡¶¨‡ßá**‡•§

üîé Splunk/grep example:

```bash
correlationId=142bfa0c-...  AND level=ERROR
```

‡¶§‡¶æ‡¶∞‡¶™‡¶∞ `"service"` ‡¶¶‡ßá‡¶ñ‡¶≤‡ßá‡¶á ‡¶¨‡ßÅ‡¶ù‡¶¨‡ßá ‡¶ï‡ßã‡¶® ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡•§

---

## 2) `traceId + spanId` (‡¶°‡¶ø‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶¨‡¶ø‡¶â‡¶ü‡ßá‡¶° ‡¶ü‡ßç‡¶∞‡ßá‡¶∏ ‡¶¨‡ßÅ‡¶ù‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)

‡¶è‡¶ï‡¶á traceId ‡¶•‡¶æ‡¶ï‡¶¨‡ßá (‡¶è‡¶ï‡¶á request), ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ:

* **‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ü‡¶æ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá‡¶∞ spanId ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ**
* parent-child span chain ‡¶•‡¶æ‡¶ï‡ßá

‡¶§‡¶æ‡¶á ‡¶§‡ßÅ‡¶Æ‡¶ø traceId ‡¶¶‡¶ø‡ßü‡ßá ‡¶∏‡¶¨ ‡¶≤‡¶ó ‡¶§‡ßÅ‡¶≤‡¶≤‡ßá, ‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá **‡¶ï‡ßã‡¶® spanId-‡¶è‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞‡ßá exception/log ‡¶π‡ßü‡ßá‡¶õ‡ßá** ‚Üí ‡¶∏‡ßá‡¶á span ‡¶Ø‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá ‡¶§‡ßà‡¶∞‡¶ø, error ‡¶ì ‡¶∏‡ßá‡¶ñ‡¶æ‡¶®‡ßá‡¶á‡•§

üîé Query idea:

```text
traceId=32c43a... AND level=ERROR
```

---

## 3) Gateway status ‡¶¨‡¶®‡¶æ‡¶Æ Downstream status (‡¶ï‡ßã‡¶•‡¶æ‡ßü fail ‡¶π‡¶≤‡ßã ‡¶¨‡ßÅ‡¶ù‡¶§‡ßá)

Gateway-‡¶è‡¶∞ log ‡¶è ‡¶Ø‡¶¶‡¶ø ‡¶•‡¶æ‡¶ï‡ßá:

* `status=500/503` ‚Üí ‡¶Æ‡¶æ‡¶®‡ßá downstream ‡¶•‡ßá‡¶ï‡ßá error ‡¶è‡¶∏‡ßá‡¶õ‡ßá ‡¶¨‡¶æ fallback ‡¶π‡ßü‡ßá‡¶õ‡ßá
  ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ **Gateway error ‡¶®‡¶æ**, ‡¶∂‡ßÅ‡¶ß‡ßÅ forward ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡•§

Downstream ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá‡¶∞ log ‡¶è ‡¶•‡¶æ‡¶ï‡¶¨‡ßá ‡¶Ü‡¶∏‡¶≤ exception:

* `NullPointerException / Validation failed / DB error / 403/404/405` etc.

‚úÖ Rule:

* Gateway log = ‚Äúrequest completed with 500‚Äù
* Real root cause = ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá‡¶∞ ERROR log (same correlationId/traceId)

---

# Practical Debug Steps (‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶ï‡ßÄ ‡¶ï‡¶∞‡¶¨‡ßá)

### Step A: ‡¶∂‡ßÅ‡¶ß‡ßÅ Error ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶¶‡ßá‡¶ñ‡ßã

Splunk/grep:

```text
correlationId="142bfa0c-..." AND level=ERROR
```

‡¶è‡¶ñ‡¶æ‡¶®‡ßá‡¶á root service ‡¶¨‡ßá‡¶∞ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá‡•§

### Step B: ‡¶Ø‡¶¶‡¶ø ERROR ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, WARN/exception ‡¶¶‡ßá‡¶ñ‡ßã

```text
correlationId="142bfa0c-..." AND (level=ERROR OR level=WARN) 
```

### Step C: timeline ‡¶¶‡ßá‡¶ñ‡ßá ‚Äú‡¶∂‡ßá‡¶∑ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‚Äù ‡¶¨‡ßá‡¶∞ ‡¶ï‡¶∞‡ßã

‡¶è‡¶ï‡¶á correlationId ‡¶¶‡¶ø‡ßü‡ßá logs sort ‡¶ï‡¶∞‡¶≤‡ßá:

* gateway ‚Üí main-service ‚Üí user-service ‚Üí (error)
  ‡¶Ø‡ßá ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá **‡¶∂‡ßá‡¶∑‡ßá exception** ‡¶Ü‡¶∏‡¶¨‡ßá ‡¶∏‡ßá‡¶ü‡¶æ‡¶á culprit.

---

# Banking Style Rule (‡¶™‡ßç‡¶∞‡¶°‡¶æ‡¶ï‡¶∂‡¶®)

‚úÖ correlationId = business tracking
‚úÖ traceId = distributed tracing
‚úÖ service = ownership (‡¶ï‡ßã‡¶® ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏ ‡¶¶‡¶æ‡ßü‡ßÄ)
‚úÖ exception stacktrace = root cause

**Same correlationId ‡¶•‡¶æ‡¶ï‡¶æ ‡¶Æ‡¶æ‡¶®‡ßá same transaction**, ‡¶ï‡¶ø‡¶®‡ßç‡¶§‡ßÅ **service field + exception** ‡¶¨‡¶≤‡ßá ‡¶¶‡ßá‡ßü ‚Äú‡¶ï‡ßã‡¶® ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá error‚Äù‡•§

---

‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶§‡ßÅ‡¶Æ‡¶ø ‡ßß‡¶ü‡¶æ correlationId-‡¶è‡¶∞ ‡¶∏‡¶¨ ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá‡¶∞ 8‚Äì10 ‡¶≤‡¶æ‡¶á‡¶®‡ßá‡¶∞ ‡¶≤‡¶ó ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶æ‡¶ì‚Äî‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶¶‡ßá‡¶ñ‡¶ø‡ßü‡ßá ‡¶¶‡ßá‡¶¨ ‡¶ï‡ßã‡¶® ‡¶∏‡¶æ‡¶∞‡ßç‡¶≠‡¶ø‡¶∏‡ßá root cause, ‡¶ï‡ßã‡¶®‡¶ü‡¶æ ‡¶∂‡ßÅ‡¶ß‡ßÅ forward ‡¶ï‡¶∞‡ßá‡¶õ‡ßá, ‡¶Ü‡¶∞ fix ‡¶ï‡ßã‡¶•‡¶æ‡ßü ‡¶π‡¶¨‡ßá‡•§
