Good ğŸ‘ this is **very important for banking systems**.
Letâ€™s do **device detection** in the **simplest possible way**, step by step.

No heavy theory. No magic.

---

# ğŸ§  What does **Detect Device** mean in banking?

It means:

> **Identify from where the user is accessing the system**

Banks care about:

* Mobile vs Web vs ATM
* New device vs known device
* Suspicious device change

---

## ğŸ§© Where device detection happens?

ğŸ‘‰ **At the API Gateway** (best place)

Why?

* Every request passes here
* Services should not repeat this logic
* Easier to log + audit + block

---

# ğŸ§± What information do we use to detect device?

### From HTTP request headers

| Header                   | Purpose                 |
| ------------------------ | ----------------------- |
| `User-Agent`             | Browser / OS / Mobile   |
| `X-Channel`              | WEB / MOBILE / ATM      |
| IP Address               | Location / risk         |
| (Optional) Custom Header | App version / device id |

---

# âœ… STEP 1 â€” Understand `User-Agent` (very simple)

Examples:

### Web (Chrome)

```
Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/122
```

### Android App

```
Mozilla/5.0 (Linux; Android 13; Pixel 7)
```

### iPhone

```
Mozilla/5.0 (iPhone; CPU iPhone OS 17_2)
```

ğŸ‘‰ From this we can detect:

* MOBILE
* WEB
* OS type

---

# âœ… STEP 2 â€” Simple Device Detection Logic (Gateway Filter)

Create a **DeviceDetectionFilter**.

```java
@Component
public class DeviceDetectionFilter implements GatewayFilter {

    @Override
    public Mono<Void> filter(ServerWebExchange exchange,
                             GatewayFilterChain chain) {

        String userAgent = exchange.getRequest()
                .getHeaders()
                .getFirst("User-Agent");

        String deviceType = detectDevice(userAgent);

        // add detected device to request
        ServerHttpRequest mutatedRequest =
                exchange.getRequest()
                        .mutate()
                        .header("X-Device-Type", deviceType)
                        .build();

        return chain.filter(
                exchange.mutate()
                        .request(mutatedRequest)
                        .build()
        );
    }

    private String detectDevice(String userAgent) {
        if (userAgent == null) return "UNKNOWN";

        userAgent = userAgent.toLowerCase();

        if (userAgent.contains("android")
                || userAgent.contains("iphone")) {
            return "MOBILE";
        }

        return "WEB";
    }
}
```

---

# âœ… STEP 3 â€” Enable it in `application.yml`

Add this filter **before services**:

```yaml
filters:
  - DeviceDetectionFilter
```

Example route:

```yaml
- id: account
  uri: http://localhost:8083
  predicates:
    - Path=/accounts/**
  filters:
    - StripPrefix=1
    - DeviceDetectionFilter
    - JwtAuthFilter
    - AddRequestHeader=X-Channel, WEB
```

---

# âœ… STEP 4 â€” How backend services use this

In **account-service** / **auth-service**:

```java
String device =
    request.getHeader("X-Device-Type");
```

Now you know:

```
MOBILE / WEB / UNKNOWN
```

---

# ğŸ§  VERY IMPORTANT (Banking Rule)

> **Device detection â‰  Device trust**

Detection just tells you **what it looks like**.

Banks ALSO:

* Store known devices
* Compare device history
* Alert on device change

Weâ€™ll do that next.

---

# âœ… STEP 5 â€” Log device info (for Splunk)

In **login success log**:

```java
LOGIN_SUCCESS user=123 device=MOBILE ip=103.x.x.x
```

In Splunk you can detect:

* Same user â†’ new device
* Too many devices â†’ fraud
* Mobile â†’ Web switch

---

# ğŸ§  Interview-ready explanation (simple & strong)

> â€œDevice detection is done at the API gateway using request headers like User-Agent, and the detected device type is forwarded to backend services for logging, fraud detection, and policy enforcement.â€

---

## ğŸ”œ NEXT logical steps (choose ONE)

1ï¸âƒ£ Store **known devices** per user
2ï¸âƒ£ Alert on **new device login** (Splunk)
3ï¸âƒ£ Add **device fingerprint** (hash-based)
4ï¸âƒ£ Channel-based rules (MOBILE vs WEB)
5ï¸âƒ£ Full **bank-grade login flow**

Just tell me the number ğŸ‘
