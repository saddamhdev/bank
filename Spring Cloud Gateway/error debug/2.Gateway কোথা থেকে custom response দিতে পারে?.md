à¦¹à§à¦¯à¦¾à¦ âœ… **Spring Cloud Gateway-à¦ custom response return à¦•à¦°à¦¾ à¦ªà§à¦°à§‹à¦ªà§à¦°à¦¿ possible** â€” à¦à¦¬à¦‚ production-à¦ à¦à¦Ÿà¦¾ à¦–à§à¦¬à¦‡ common practiceà¥¤

Spring Cloud Gateway

à¦šà¦² **à¦•à¦–à¦¨, à¦•à§‹à¦¥à¦¾ à¦¥à§‡à¦•à§‡, à¦•à§€à¦­à¦¾à¦¬à§‡** custom response à¦¦à§‡à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿâ€”à¦à¦‡à¦Ÿà¦¾ cleanà¦­à¦¾à¦¬à§‡ à¦­à§‡à¦™à§‡ à¦¦à§‡à¦–à¦¿ ğŸ‘‡

---

## ğŸ§  Big Picture: Gateway à¦•à§‹à¦¥à¦¾ à¦¥à§‡à¦•à§‡ custom response à¦¦à¦¿à¦¤à§‡ à¦ªà¦¾à¦°à§‡?

```
Client Request
   â†“
Gateway
 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
 â”‚ Pre Filter    â”‚ â† âœ… custom response
 â”‚ Route Match   â”‚ â† âŒ (directly à¦¨à¦¾)
 â”‚ Proxy Call    â”‚
 â”‚ Post Filter   â”‚ â† âœ… custom response
 â”‚ Error Handler â”‚ â† âœ… custom response
 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… 4à¦Ÿà¦¾ à¦œà¦¾à§Ÿà¦—à¦¾ à¦¥à§‡à¦•à§‡ Custom Response à¦¦à§‡à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿ

---

## 1ï¸âƒ£ **Pre Filter à¦¥à§‡à¦•à§‡** (à¦¸à¦¬à¦šà§‡à§Ÿà§‡ common ğŸ”¥)

ğŸ‘‰ Token invalid, rate limit exceeded, IP blocked

### Example: JWT invalid à¦¹à¦²à§‡ custom JSON

```java
@Component
public class JwtFilter implements GlobalFilter {

    @Override
    public Mono<Void> filter(ServerWebExchange exchange,
                             GatewayFilterChain chain) {

        if (tokenInvalid(exchange)) {
            exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
            exchange.getResponse().getHeaders()
                    .setContentType(MediaType.APPLICATION_JSON);

            String body = """
            {
              "error": "INVALID_TOKEN",
              "message": "Token is not valid"
            }
            """;

            DataBuffer buffer = exchange.getResponse()
                    .bufferFactory()
                    .wrap(body.getBytes());

            return exchange.getResponse().writeWith(Mono.just(buffer));
        }

        return chain.filter(exchange);
    }
}
```

ğŸ‘‰ Backend **call à¦¹à§Ÿ à¦¨à¦¾**
ğŸ‘‰ Client clean JSON à¦ªà¦¾à§Ÿ

---

## 2ï¸âƒ£ **Post Filter à¦¥à§‡à¦•à§‡** (response modify)

ğŸ‘‰ Backend response decorate / rewrite

### Example: Add custom response header

```yaml
filters:
  - AddResponseHeader=X-Gateway, handled-by-gateway
```

### Example: Rewrite Location header

```yaml
filters:
  - RewriteResponseHeader=Location, /internal/(.*), /api/$1
```

âš ï¸ à¦à¦–à¦¾à¦¨à§‡ backend already call à¦¹à§Ÿà§‡à¦›à§‡

---

## 3ï¸âƒ£ **Fallback Endpoint à¦¥à§‡à¦•à§‡** (service down)

ğŸ‘‰ Circuit Breaker use à¦•à¦°à¦²à§‡

```yaml
filters:
  - name: CircuitBreaker
    args:
      name: userCB
      fallbackUri: forward:/fallback/users
```

```java
@RestController
class FallbackController {

    @GetMapping("/fallback/users")
    public Mono<Map<String, Object>> fallback() {
        return Mono.just(Map.of(
            "error", "SERVICE_DOWN",
            "message", "User service unavailable"
        ));
    }
}
```

---

## 4ï¸âƒ£ **Global Error Handler à¦¥à§‡à¦•à§‡** (No route / unexpected error)

ğŸ‘‰ â€œGateway not foundâ€, 404, 500 customize à¦•à¦°à¦¤à§‡

```java
@Component
public class GatewayErrorHandler
        extends DefaultErrorWebExceptionHandler {
   // override getErrorAttributes()
}
```

Example response:

```json
{
  "error": "NO_ROUTE_FOUND",
  "path": "/api/unknown",
  "timestamp": "2026-02-08T12:00:00"
}
```

---

## âŒ à¦•à§‹à¦¥à¦¾à§Ÿ custom response à¦¦à§‡à¦“à§Ÿà¦¾ à¦¯à¦¾à§Ÿ à¦¨à¦¾?

| Case                     | Reason              |
| ------------------------ | ------------------- |
| Route predicate section  | No response context |
| After response committed | Too late            |
| Netty level              | Transport only      |

---

## ğŸ§  Which approach when? (Quick decision)

| Situation            | Best place    |
| -------------------- | ------------- |
| Auth / Token invalid | Pre Filter    |
| Rate limit           | Pre Filter    |
| Backend down         | Fallback      |
| No route found       | Error Handler |
| Header / body modify | Post Filter   |

---

## ğŸ§© Ultra-simple analogy

* **Pre filter** â†’ Guard says â€œYou canâ€™t enterâ€ ğŸš«
* **Fallback** â†’ Office closed notice ğŸ¢
* **Post filter** â†’ Receipt stamp ğŸ§¾
* **Error handler** â†’ Help desk ğŸ“

---

## âœ… Interview-ready one-liner

> **Spring Cloud Gateway can return custom responses using pre-filters, post-filters, fallback routes, or a global error handler, without calling backend services.**

---

à¦¯à¦¦à¦¿ à¦šà¦¾à¦“, next step à¦ à¦†à¦®à¦¿ à¦¦à§‡à¦–à¦¾à¦¤à§‡ à¦ªà¦¾à¦°à¦¿:

* ğŸ”¹ Production-ready error JSON standard
* ğŸ”¹ One global filter handling all errors
* ğŸ”¹ Custom 404 vs backend 404 difference
* ğŸ”¹ How banks design gateway error responses

à¦¬à¦²à¦²à§‡à¦‡ next deep dive ğŸš€
