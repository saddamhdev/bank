à¦šà¦² à¦à¦•à¦¦à¦® **practical + production-ready** à¦­à¦¾à¦¬à§‡ à¦¦à§‡à¦–à¦¿
ğŸ‘‰ **à¦à¦•à¦‡ Custom GlobalFilter à¦¦à¦¿à§Ÿà§‡ Pre + Post à¦¦à§à¦Ÿà§‹à¦‡ à¦•à¦°à¦¾**,
ğŸ‘‰ **YML à¦¦à¦¿à§Ÿà§‡ enable / config control à¦•à¦°à¦¾** ğŸ”¥

Spring Cloud Gateway

---

## ğŸ§  Core Idea (à¦†à¦—à§‡ à¦®à¦¾à¦¥à¦¾à§Ÿ à¦¬à¦¸à¦¾à¦“)

> **à¦à¦•à¦Ÿà¦¾ GlobalFilter = Pre + Post à¦à¦•à¦¸à¦¾à¦¥à§‡**
> à¦•à¦¾à¦°à¦£ Reactive chain-à¦:

* `chain.filter(exchange)` â†’ **pre à¦¶à§‡à¦·, backend call**
* `.then(...)` â†’ **post start (response à¦†à¦¸à¦¾à¦° à¦ªà¦°à§‡)**

---

## ğŸ” Lifecycle (Visual)

```
Request
 â†“
GlobalFilter (PRE logic)
 â†“
Backend call
 â†“
GlobalFilter (POST logic)
 â†“
Response
```

---

## 1ï¸âƒ£ YML: Filter enable + config

à¦†à¦®à¦°à¦¾ à¦§à¦°à¦›à¦¿:

* Filter on/off à¦¹à¦¬à§‡ YML à¦¦à¦¿à§Ÿà§‡
* Header name / message configurable

```yaml
gateway:
  logging:
    enabled: true
    request-header: X-Gateway-Request
    response-header: X-Gateway-Response
```

ğŸ‘‰ à¦à¦Ÿà¦¾ **pure config**, run à¦¹à§Ÿ à¦¨à¦¾ â€” Spring bind à¦•à¦°à¦¬à§‡

---

## 2ï¸âƒ£ YML â†’ Java Config Bean

```java
@Component
@ConfigurationProperties(prefix = "gateway.logging")
public class GatewayLoggingConfig {

    private boolean enabled;
    private String requestHeader;
    private String responseHeader;

    // getters & setters
}
```

âœ”ï¸ Startup-à¦ bean à¦¤à§ˆà¦°à¦¿ à¦¹à§Ÿà§‡ à¦¯à¦¾à¦¬à§‡

---

## 3ï¸âƒ£ Custom GlobalFilter (PRE + POST together)

à¦à¦Ÿà¦¾à¦‡ à¦†à¦¸à¦² à¦œà¦¿à¦¨à¦¿à¦¸ ğŸ”¥

```java
@Component
public class LoggingGlobalFilter implements GlobalFilter, Ordered {

    private final GatewayLoggingConfig config;

    public LoggingGlobalFilter(GatewayLoggingConfig config) {
        this.config = config;
    }

    @Override
    public Mono<Void> filter(ServerWebExchange exchange,
                             GatewayFilterChain chain) {

        // ---------- PRE FILTER ----------
        if (config.isEnabled()) {
            exchange.getRequest().mutate()
                .header(config.getRequestHeader(), "processed-by-gateway")
                .build();

            System.out.println("PRE :: Request path = "
                    + exchange.getRequest().getURI().getPath());
        }

        long startTime = System.currentTimeMillis();

        // ---------- BACKEND CALL ----------
        return chain.filter(exchange)

            // ---------- POST FILTER ----------
            .then(Mono.fromRunnable(() -> {
                if (config.isEnabled()) {
                    long duration = System.currentTimeMillis() - startTime;

                    exchange.getResponse().getHeaders()
                        .add(config.getResponseHeader(),
                             "time=" + duration + "ms");

                    System.out.println("POST :: Response sent in "
                            + duration + "ms");
                }
            }));
    }

    @Override
    public int getOrder() {
        return -1; // very early
    }
}
```

---

## ğŸ” à¦à¦–à¦¾à¦¨à§‡ à¦•à§€ à¦¹à¦šà§à¦›à§‡ (line by line mindset)

### ğŸŸ¦ PRE part

```java
exchange.getRequest().mutate().header(...)
```

âœ”ï¸ Backend-à¦ à¦¯à¦¾à¦“à§Ÿà¦¾à¦° à¦†à¦—à§‡à¦‡ request modify
âœ”ï¸ Auth, logging, rate-limit â€” à¦¸à¦¬ à¦à¦–à¦¾à¦¨à§‡

---

### ğŸŸ¨ `chain.filter(exchange)`

ğŸ‘‰ à¦à¦‡ à¦²à¦¾à¦‡à¦¨à§‡:

* Gateway à¦¬à¦²à§‡ â€œOK, forward à¦•à¦°à§‹â€
* Backend call à¦¹à§Ÿ
* Response à¦«à¦¿à¦°à§‡ à¦†à¦¸à§‡

---

### ğŸŸ© POST part

```java
.then(Mono.fromRunnable(() -> { ... }))
```

âœ”ï¸ Response à¦†à¦¸à¦¾à¦° à¦ªà¦°à§‡
âœ”ï¸ Header add / metrics / logging
âœ”ï¸ Client-à¦ à¦ªà¦¾à¦ à¦¾à¦¨à§‹à¦° à¦†à¦— à¦®à§à¦¹à§‚à¦°à§à¦¤

---

## 4ï¸âƒ£ Result (Client à¦¯à¦¾ à¦¦à§‡à¦–à¦¬à§‡)

### Request headers (backend side)

```
X-Gateway-Request: processed-by-gateway
```

### Response headers (client side)

```
X-Gateway-Response: time=32ms
```

---

## â— Very Important Rules (Interview Gold)

| Rule                              | Why                 |
| --------------------------------- | ------------------- |
| `chain.filter()` à¦¨à¦¾ à¦¡à¦¾à¦•à¦²à§‡         | Backend call à¦¹à¦¬à§‡ à¦¨à¦¾ |
| Pre logic = before `chain.filter` | Request control     |
| Post logic = `.then()`            | Response control    |
| GlobalFilter                      | All routes          |
| GatewayFilter                     | Single route        |

---

## ğŸ§© Common Mistake âŒ

```java
return Mono.fromRunnable(() -> { ... }); // WRONG
```

ğŸ‘‰ à¦à¦¤à§‡ backend call à¦¹à¦¬à§‡ à¦¨à¦¾

---

## ğŸ§  Ultra-simple analogy

* **Pre** â†’ Passport check ğŸ›‚
* **chain.filter** â†’ Plane flight âœˆï¸
* **Post** â†’ Arrival stamp ğŸ›¬

---

## âœ… Interview-ready one-liner

> **A GlobalFilter in Spring Cloud Gateway can implement both pre and post logic by executing code before `chain.filter()` and after it using reactive callbacks.**

---

à¦šà¦¾à¦“ à¦¤à§‹ next step à¦ à¦†à¦®à¦¿ à¦¦à§‡à¦–à¦¾à¦¤à§‡ à¦ªà¦¾à¦°à¦¿:

* ğŸ”¹ JWT auth + post audit log in one filter
* ğŸ”¹ GlobalFilter vs GatewayFilter comparison
* ğŸ”¹ Order problem debugging
* ğŸ”¹ Banking-style audit trail filter

à¦¬à¦²à¦²à§‡à¦‡ next deep dive ğŸš€
