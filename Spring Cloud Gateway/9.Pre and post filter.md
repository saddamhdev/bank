ржЪрж▓ **Pre Filter vs Post Filter** ржПржХржжржо **ground-up**, **timeline + responsibility + example** ржжрж┐рзЯрзЗ ржкрж░рж┐рж╖рзНржХрж╛рж░ ржХрж░рж┐тАФржПржЯрж╛ржЗ Gateway ржмрзЛржЭрж╛рж░ backbone ЁЯзаЁЯФе

Spring Cloud Gateway

---

## ЁЯза One-line Core Idea

> **Pre filter = backend-ржП ржпрж╛ржУрзЯрж╛рж░ ржЖржЧрзЗ request control**
> **Post filter = backend ржерзЗржХрзЗ ржЖрж╕рж╛рж░ ржкрж░рзЗ response polish**

---

## ЁЯФБ Request Lifecycle (Where Pre & Post Sit)

```
Client Request
   тЖУ
Route Match (Predicate)
   тЖУ
ЁЯЯж Pre Filters
   тЖУ
Proxy to Backend Service
   тЖУ
ЁЯЯй Post Filters
   тЖУ
Client Response
```

---

## ЁЯЯж PRE FILTER (Request ржпрж╛ржУрзЯрж╛рж░ ржЖржЧрзЗ)

### ЁЯОп ржХрж╛ржЬ ржХрзА?

Backend-ржП ржкрж╛ржарж╛ржирзЛ request **ржпрж╛ржмрзЗ ржХрж┐ржирж╛**, **ржХрзАржнрж╛ржмрзЗ ржпрж╛ржмрзЗ**, **ржХрзА ржирж┐рзЯрзЗ ржпрж╛ржмрзЗ**тАФржПржЗ рж╕рж┐ржжрзНржзрж╛ржирзНрждред

### ЁЯФз рж╕рж╛ржзрж╛рж░ржг ржХрж╛ржЬржЧрзБрж▓рзЛ

* JWT / OAuth token validate
* Rate limit
* IP block
* Request **path rewrite**
* Header add/remove
* Query param modify

### ЁЯзк Example: Path Rewrite (Backend-ржПрж░ ржЬржирзНржп)

```yaml
filters:
  - RewritePath=/api/(?<segment>.*), /${segment}
```

ЁЯСЙ Client calls `/api/users/1`
ЁЯСЙ Backend receives `/users/1`

---

### ЁЯзк Example: Token Invalid рж╣рж▓рзЗ STOP

```java
if (tokenInvalid) {
    exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
    return exchange.getResponse().setComplete(); // тЫФ STOP HERE
}
return chain.filter(exchange); // тЬЕ Continue
```

ЁЯСЙ Backend ржЬрж╛ржирзЗржЗ ржирж╛ request ржПрж╕рзЗржЫрж┐рж▓

---

## ЁЯЯй POST FILTER (Response ржЖрж╕рж╛рж░ ржкрж░рзЗ)

### ЁЯОп ржХрж╛ржЬ ржХрзА?

Backend response **client-ржП ржпрж╛ржУрзЯрж╛рж░ ржЖржЧрзЗ рж╕рж╛ржЬрж╛ржирзЛ/ржмржжрж▓рж╛ржирзЛ**ред

### ЁЯФз рж╕рж╛ржзрж╛рж░ржг ржХрж╛ржЬржЧрзБрж▓рзЛ

* Response header add/remove
* `Location` header rewrite
* Logging / metrics
* Response body modify (advanced)
* Mask sensitive data

### ЁЯзк Example: Response Header Add

```yaml
filters:
  - AddResponseHeader=X-Gateway, processed
```

ЁЯСЙ Client response-ржП header ржпрзЛржЧ рж╣рзЯ

---

### ЁЯзк Example: Location Header Rewrite

```yaml
filters:
  - RewriteResponseHeader=Location, /internal/(.*), /api/$1
```

ЁЯСЙ Backend ржжрзЗрзЯ `/internal/users/1`
ЁЯСЙ Client ржкрж╛рзЯ `/api/users/1`

---

## тЭМ Post Filter-ржП ржпрзЗржЯрж╛ ржХрж░рж╛ ржпрж╛рзЯ ржирж╛

* Backend-ржП ржпрж╛ржУрзЯрж╛рж░ request path change тЭМ
* Route change тЭМ
* ржЕржирзНржп service-ржП forward тЭМ

ржПржЗржЧрзБрж▓рзЛ **pre filter**-ржПрж░ ржХрж╛ржЬред

---

## ЁЯза Side-by-Side Comparison

| Topic                  | Pre Filter          | Post Filter             |
| ---------------------- | ------------------- | ----------------------- |
| ржХржЦржи ржЪрж▓рзЗ                | Backend call-ржПрж░ ржЖржЧрзЗ | Backend response-ржПрж░ ржкрж░рзЗ |
| Control ржХрж░рзЗ            | Request             | Response                |
| Path rewrite (backend) | тЬЕ                   | тЭМ                       |
| Auth / Rate limit      | тЬЕ                   | тЭМ                       |
| Response header/body   | тЭМ                   | тЬЕ                       |
| Stop request           | тЬЕ                   | тЭМ (already done)        |

---

## ЁЯФв Order Matters (Very Important)

Filters ordered рж╣рзЯ:

```
Global Pre Filters
тЖТ Route Pre Filters
тЖТ Proxy
тЖТ Route Post Filters
тЖТ Global Post Filters
```

Security filter **рж╕ржмржЪрзЗрзЯрзЗ ржЖржЧрзЗ**
Logging filter **рж╢рзЗрж╖рзЗ**

---

## ЁЯзй Ultra-Simple Analogy

* ЁЯЫВ **Pre filter** = Airport security (ржпрж╛ржмрзЗ ржХрж┐ржирж╛ ржарж┐ржХ ржХрж░рзЗ)
* ЁЯз│ **Post filter** = Arrival desk (рж╕рзНржЯрзНржпрж╛ржорзНржк, info ржжрзЗрзЯ)

Security ржкрж╛рж░ рж╣рж▓рзЗ рждржмрзЗржЗ plane тЬИя╕П

---

## тЬЕ Interview-Ready Lines

* **Pre filters modify or block requests before forwarding to backend.**
* **Post filters modify responses after backend processing.**
* **Request path rewriting for routing must happen in pre filters.**

---

ржпржжрж┐ ржЪрж╛ржУ, ржкрж░рзЗрж░ ржзрж╛ржкрзЗ ржЖржорж┐ ржжрзЗржЦрж╛рждрзЗ ржкрж╛рж░рж┐:

* ЁЯФ╣ Custom GlobalFilter (pre + post together)
* ЁЯФ╣ Filter order debugging
* ЁЯФ╣ JWT + Rate limit combined flow
* ЁЯФ╣ Real production filter mistakes

ржмрж▓рж▓рзЗржЗ next deep dive ЁЯЪА
