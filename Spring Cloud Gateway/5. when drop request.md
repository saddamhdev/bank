рж╣рзНржпрж╛ржБтАФ**ржПржХ ржХржерж╛рзЯ: рж╣рзНржпрж╛ржБ, Gateway Engine рждржЦржиржЗ request тАЬdropтАЭ ржХрж░рзЗ** тЬЕ
ржХрж┐ржирзНрждрзБ *ржХрзАржнрж╛ржмрзЗ* drop ржХрж░рзЗ, рж╕рзЗржЯрж╛ ржмрзБржЭрж▓рзЗржЗ рждрзБржорж┐ production-ready level ржП ржкрзМржБржЫрзЗ ржпрж╛ржмрзЗред ржЪрж▓ ржнрзЗрждрж░рзЗрж░ flow ржЯрж╛ ржжрзЗржЦрж┐ред

---

## ЁЯФР Scenario: Filter-ржП Token Invalid рж╣рж▓рзЗ ржХрзА рж╣рзЯ?

```
Client Request (JWT)
        тЖУ
Gateway Predicate Match
        тЖУ
JWT Filter (Pre-filter)
        тЖУ
тЭМ Token Invalid
        тЖУ
Response Written (401 / 403)
        тЖУ
Request Chain STOP
        тЖУ
тЭМ Backend NOT called
```

ЁЯСЙ ржПржЯрж╛ржХрзЗржЗ ржмрж▓рж╛ рж╣рзЯ **short-circuiting the filter chain**

---

## ЁЯза ржнрзЗрждрж░рзЗ ржЖрж╕рж▓рзЗ ржХрзА рж╣рзЯ (Java Level)

Spring Cloud Gateway filter ржЖрж╕рж▓рзЗ ржПржоржи ржХрж┐ржЫрзБ ржХрж░рзЗ ЁЯСЗ

```java
public Mono<Void> filter(ServerWebExchange exchange,
                          GatewayFilterChain chain) {

    if (tokenInvalid) {
        exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
        return exchange.getResponse().setComplete(); // тЫФ STOP
    }

    return chain.filter(exchange); // тЬЕ Continue
}
```

### ЁЯФ┤ ржПржЗ рж▓рж╛ржЗржирзЗ рж╕ржм рж╢рзЗрж╖

```java
return exchange.getResponse().setComplete();
```

ржПржЯрж╛ ржорж╛ржирзЗ:

* тЭМ ржЖрж░ ржХрзЛржирзЛ filter ржЪрж▓ржмрзЗ ржирж╛
* тЭМ Proxy рж╣ржмрзЗ ржирж╛
* тЭМ Backend service ржЬрж╛ржиржмрзЗржЗ ржирж╛ request ржПрж╕рзЗржЫрж┐рж▓

---

## тЭУ ржПржЯрж╛ ржХрж┐ рж╕рждрзНржпрж┐ тАЬdropтАЭ?

ЁЯСЙ Technically:

* **Network-level drop ржирж╛**
* **Application-level terminate**

Client ржХрж┐ржирзНрждрзБ response ржкрж╛рзЯ:

```http
401 Unauthorized
```

---

## ЁЯФН Filter Execution Rule (Golden Rule)

| Condition                     | Result                          |
| ----------------------------- | ------------------------------- |
| `chain.filter()` call ржХрж░рж╛     | Request ржПржЧрзЛрзЯ                    |
| Response рж▓рж┐ржЦрзЗ `setComplete()` | Request ржПржЦрж╛ржирзЗржЗ рж╢рзЗрж╖              |
| Exception throw               | Global error handler handle ржХрж░рзЗ |

---

## ЁЯФР Security Filter Order (Important)

Gateway-рждрзЗ рж╕рж╛ржзрж╛рж░ржгржд order ржПржоржи рж╣рзЯ:

1. Global JWT Filter
2. Rate Limit Filter
3. Route Filter
4. Proxy Filter

ЁЯСЙ Token invalid рж╣рж▓рзЗ **рж╕ржмржЪрзЗрзЯрзЗ ржЖржЧрзЗржЗ** block

---

## ЁЯПж Enterprise Practice

Banking / Fintech system-ржП:

* Token invalid тЖТ **401**
* Token expired тЖТ **403**
* IP blocked тЖТ **429**
* No body leak (security)

Backend service:

> тАЬржЖржорж┐ ржЬрж╛ржирж┐ржУ ржирж╛ ржХрзЗржЙ call ржХрж░рзЗржЫрж┐рж▓тАЭ ЁЯШД

---

## ЁЯзк Bonus: What if filter throws exception?

```java
throw new RuntimeException("Invalid Token");
```

тЮбя╕П Gateway GlobalErrorHandler handle ржХрж░ржмрзЗ
тЮбя╕П Response ржпрж╛ржмрзЗ
тЮбя╕П Backend call рж╣ржмрзЗ ржирж╛

---

## ЁЯза Final Truth (Interview Line ЁЯОп)

> **In Spring Cloud Gateway, filters can short-circuit the request. If a filter does not call `chain.filter()`, the request never reaches the backend.**

---

## рждрзБржорж┐ ржЪрж╛ржЗрж▓рзЗ next step:

* ЁЯФ╣ JWT filter full production code
* ЁЯФ╣ GlobalFilter vs GatewayFilter
* ЁЯФ╣ Order matters (why?)
* ЁЯФ╣ Custom error response JSON
* ЁЯФ╣ Rate limit + auth combined

ржмрж▓рж▓рзЗржЗ ржЖрж░рзЗржХ рж▓рзЗрзЯрж╛рж░ ржЦрзБрж▓рзЗ ржжрж┐ржЗ ЁЯФУЁЯФе
