ржЪрж▓ ЁЯСН
ржПржЦржи **ржПржХржжржо ржкрж░рж┐рж╖рзНржХрж╛рж░ржнрж╛ржмрзЗ** ржжрзЗржЦрж╛ржЗтАФ
**ржПржЗ тАЬcheck тЖТ output тЖТ useтАЭ ржЬрж┐ржирж┐рж╕ржЧрзБрж▓рзЛ Spring Cloud Gateway ржХрзАржнрж╛ржмрзЗ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ**ред

ржЖржорж┐ **рзйржЯрж╛ рж▓рзЗрзЯрж╛рж░рзЗ** ржмрзБржЭрж╛ржмрзЛ, ржпрзЗржи ржорж╛ржерж╛рзЯ ржмрж╕рзЗ ржпрж╛рзЯред

---

# ЁЯза Spring Cloud Gateway ржХрзЛржерж╛рзЯ ржмрж╕рзЗ?

```
Client
 тЖТ Spring Cloud Gateway
     тФЬтФА Filters (check + modify)
     тФЬтФА Security (JWT / rate limit)
 тЖТ Downstream Microservice
```

ЁЯСЙ Gateway = **ржЖржЧрзЗ check ржХрж░рж╛рж░ ржЬрж╛рзЯржЧрж╛**

---

# 1я╕ПтГг Gateway-рждрзЗ тАЬcheckтАЭ ржХрж┐ржнрж╛ржмрзЗ рж╣рзЯ?

Spring Cloud Gateway-рждрзЗ **рж╕ржм check рж╣рзЯ FILTER ржжрж┐рзЯрзЗ**
(Controller ржирж╛ржЗ, Service ржирж╛ржЗ)

### ржжрзБржЗ ржзрж░ржирзЗрж░ filter ржЖржЫрзЗ:

1. **Built-in filter** (Spring ржжрзЗрзЯ)
2. **Custom filter** (рждрзБржорж┐ рж▓рзЗржЦрзЛ)

---

## ЁЯФ╣ A) Built-in filter ржжрж┐рзЯрзЗ check

### Example: Rate limit (login)

```yaml
filters:
  - name: RequestRateLimiter
    args:
      redis-rate-limiter.replenishRate: 2
      redis-rate-limiter.burstCapacity: 5
      key-resolver: "#{@ipKeyResolver}"
```

### ржПржЦрж╛ржирзЗ ржХрзА check рж╣рзЯ?

* ржПржХржЗ IP ржерзЗржХрзЗ ржмрзЗрж╢рж┐ request ржЖрж╕ржЫрзЗ ржХрж┐ржирж╛

### Output ржХрзА?

* тЭМ ржмрзЗрж╢рж┐ рж╣рж▓рзЗ тЖТ `429 Too Many Requests`
* тЬЕ ржарж┐ржХ ржерж╛ржХрж▓рзЗ тЖТ next step

ЁЯСЙ Controller-ржП ржпрж╛ржУрзЯрж╛рж░ ржЖржЧрзЗржЗ block

---

## ЁЯФ╣ B) Custom filter ржжрж┐рзЯрзЗ check (рж╕ржмржЪрзЗрзЯрзЗ important)

### Example: Device detect

```java
@Component
public class DeviceDetectionFilter implements GatewayFilter {

    @Override
    public Mono<Void> filter(ServerWebExchange exchange,
                             GatewayFilterChain chain) {

        String ua = exchange.getRequest()
                            .getHeaders()
                            .getFirst("User-Agent");

        String device = ua != null && ua.contains("Android")
                        ? "MOBILE" : "WEB";

        // тЬЕ OUTPUT attach ржХрж░рж╛
        ServerHttpRequest mutated =
            exchange.getRequest()
                    .mutate()
                    .header("X-Device-Type", device)
                    .build();

        return chain.filter(exchange.mutate()
                                     .request(mutated)
                                     .build());
    }
}
```

### ржПржЦрж╛ржирзЗ ржХрзА check рж╣рж▓рзЛ?

* User-Agent ржжрзЗржЦрзЗ device

### Output ржХрзА?

```
X-Device-Type: MOBILE / WEB
```

ЁЯСЙ ржПржЗ output **ржкрж░рзЗрж░ service ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗ**

---

# 2я╕ПтГг Gateway output ржХрж┐ржнрж╛ржмрзЗ тАЬржХрж╛ржЬрзЗ рж▓рж╛ржЧрзЗтАЭ?

Gateway-рждрзЗ check ржХрж░рж╛рж░ ржкрж░ output рзкржнрж╛ржмрзЗ ржХрж╛ржЬрзЗ рж▓рж╛ржЧрзЗ:

---

## тЬЕ 1) Block / Allow

```java
if (invalid) {
  exchange.getResponse().setStatusCode(HttpStatus.UNAUTHORIZED);
  return exchange.getResponse().setComplete();
}
```

ЁЯСЙ Result:

* Controller ржкрж░рзНржпржирзНржд ржпрж╛рзЯ ржирж╛
* Service hit рж╣рзЯ ржирж╛

---

## тЬЕ 2) Header ржЖржХрж╛рж░рзЗ ржкрж╛ржарж╛ржирзЛ (рж╕ржмржЪрзЗрзЯрзЗ common)

```java
.header("X-Device-Type", "MOBILE")
.header("X-Trace-Id", uuid)
```

Downstream service-ржП:

```java
request.getHeader("X-Device-Type");
```

ЁЯСЙ Fraud / limit / audit logic

---

## тЬЕ 3) Security Context (JWT case)

Gateway-рждрзЗ JWT valid рж╣рж▓рзЗ:

* Request allow рж╣рзЯ
* Service ржзрж░рзЗ ржирзЗрзЯ user authenticated

(ржЕржирзЗржХ bank-ржП service ржЖрж░ token check ржХрж░рзЗ ржирж╛)

---

## тЬЕ 4) Logging / Audit (Splunk)

Gateway-рждрзЗржЗ log рж▓рзЗржЦрж╛ рж╣рзЯ:

```
REQUEST_ALLOWED path=/txns
device=MOBILE
traceId=abc123
```

ЁЯСЙ SOC / Audit team ржжрзЗржЦрзЗ

---

# 3я╕ПтГг Real banking flow (Gateway perspective)

### Login request

```
POST /auth/login
```

Gateway:
1я╕ПтГг Rate limit check
2я╕ПтГг Device detect
3я╕ПтГг IP log
4я╕ПтГг Allow тЖТ auth-service

---

### Transfer request

```
POST /txns/transfer
```

Gateway:
1я╕ПтГг JWT check
2я╕ПтГг Device detect
3я╕ПтГг Channel attach
4я╕ПтГг Trace-ID add
5я╕ПтГг Forward to txn-service

---

# ЁЯза ржЦрзБржм рж╕рж╣ржЬ ржХрж░рзЗ ржоржирзЗ рж░рж╛ржЦрзЛ

```
Gateway = 
  Check ржХрж░рзЗ тЖТ
  Output ржмрж╛ржирж╛рзЯ тЖТ
  Output forward ржХрж░рзЗ тЖТ
  Service рж╕рж┐ржжрзНржзрж╛ржирзНржд ржирзЗрзЯ
```

---

# ЁЯПж Bank-style rule

> тЭМ Gateway-ржП business logic ржирж╛ржЗ
> тЬЕ Gateway-ржП **policy + security + metadata**

---

## ЁЯОд Interview-ржП ржмрж▓рж╛рж░ ржорждрзЛ ржПржХ рж▓рж╛ржЗржи

> тАЬSpring Cloud Gateway uses filters to perform pre-request checks, enrich requests with headers or context, and either block or forward traffic to downstream microservices.тАЭ

---

## ЁЯФЬ ржПржЦржи рждрзБржорж┐ ржХрзА ржжрзЗржЦрждрзЗ ржЪрж╛ржУ?

1я╕ПтГг Gateway тЖТ Service output use example
2я╕ПтГг Full login + transfer sequence diagram
3я╕ПтГг Gateway filter execution order
4я╕ПтГг Splunk-ржП gateway log analyse

ЁЯСЙ ржирж╛ржорзНржмрж╛рж░ ржмрж▓рзЛ ЁЯСН
